{# templates/home.html #}

{% extends "base.html" %}

{% block content %}
<div class="content-wrapper">
    <div class="left-side">
        <div class="about-wrapper">
            <div class="blurb-box">
                <div class="blurb-text" id="about-header">
                    Welcome to <b>Titanic!</b>
                </div>
                <div class="blurb-text">
                    Titanic is a private server for <a href="https://osu.ppy.sh">osu!</a>, dedicated to preserving the nostalgia of osu!'s earlier days, offering players the opportunity to experience the game using client versions from 2008 to 2014.
                    It's also a community-driven project that is fully open source and open to all kinds of contribution. Even just a simple suggestion can make a big change.
                    So, welcome on board, and enjoy your stay!
                </div>
            </div>
        </div>

        <div class="news-wrapper">
            <h2 class="headers">News</h2>
            {% if not news %}
                <div class="news">
                    <div class="blurb-box">
                        No news available at the moment.
                    </div>
                </div>
            {% else %}
            {% for message in news %}
                <div class="news">
                    <div class="blurb-heading">
                        {{ message['date'] }} <a href="{{ message['link'] }}"><b>{{ message['title'] }}</b></a> ({{ message['author'] }})
                    </div>
                    <div class="blurb-box">
                        <div class="blurb-text">
                            {{ message['text']|bbcode_no_wrapper|safe }}
                        </div>
                    </div>
                    <div class="blurb-readmore">
                        <a href="{{ message['link'] }}">Read More / Comment...</a>
                    </div>
                </div>
            {% endfor %}
            {# Add more spacing between news and bottom stats if needed #}
            <div style="margin-bottom: 350px"></div>
            {% endif %}
        </div>

        <div class="bottom-stats">
            <div class="stats-wrapper">
                <h2 class="headers">Online Users<span>Over the last 24 hours</span></h2>
                <img src="/api/activity" alt="User Activity">
            </div>

            <div class="chat-wrapper">
                <h2 class="headers">Chat</h2>
                {# TODO: Format chat links #}
                <table class="styled-table">
                    <tbody>
                    {% for message in messages|reverse %}
                        {% if loop.index0 % 2 %}
                            <tr class="light-row">
                        {% else %}
                            <tr class="dark-row">
                        {% endif %}
                            <td style="color: grey; width: 10%">{{ message.time.strftime("%H:%M:%S") }}</th>
                            <td>
                                {{ message.sender }}: {{ message.message|format_chat|safe }}
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="right-side">
        <a href="/download">
            <img height="55px" src="/images/buttons/download-button.png" alt="Download"/>
        </a>
        <a href="https://github.com/osuTitanic/">
            <img height="55px" src="/images/buttons/contribute-button.png" alt="Contribute"/>
        </a>
        <a href="https://ko-fi.com/lekuru">
            <img height="55px" src="/images/buttons/support-button.png" alt="Support"/>
        </a>
        <div class="featured">
            <h2 class="headers">Featured Video</h2>
            <iframe
                title="Featured"
                width="356"
                height="278"
                type="text/html"
                style="border: 0;"
                src="https://www.youtube.com/embed?listType=playlist&list=UUir7A_JJa1Vhg_84ejh6Ung&mute=1&autoplay=1&controls=0&rel=0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                loading="lazy"
                allowfullscreen
            ></iframe>
        </div>
        <div class="most-played">
            <h2 class="headers">
                Most Played Beatmaps
                {# TODO: Last 24 hours lol #}
                {# <span>Over the last 24 hours</span> #}
            </h2>
            <table class="styled-table">
                <thead>
                    <tr>
                      <th scope="col">Plays</th>
                      <th scope="col" style="text-align: center;">Artist / Title</th>
                      <th scope="col">Creator</th>
                    </tr>
                </thead>
                <tbody>
                {% for plays in most_played %}
                    {% if loop.index0 % 2 %}
                        <tr class="light-row">
                    {% else %}
                        <tr class="dark-row">
                    {% endif %}
                        <td>{{ plays['count'] }}</th>
                        <td>
                            <a href="/b/{{ plays['beatmap_id'] }}">
                                <img src="{{ config.STATIC_BASEURL }}/mt/{{ plays['set_id'] }}" loading="lazy" alt="image"/>
                                {{ plays['artist'] }} - {{ plays['title'] }} [{{ plays['version'] }}]
                            </a>
                        </td>
                    {% if plays['server'] == 0 %}
                        <td><a href="https://osu.ppy.sh/u/{{ plays['creator'] }}">{{ plays['creator'] }}</a></td>
                    {% else %}
                        <td><a href="/u/{{ plays['creator_id'] }}">{{ plays['creator'] }}</a></td>
                    {% endif %}
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock content %}